# 微信小程序总结

### 小程序概述

##### 四种文件

```
index.js 是页面的脚本逻辑文件
index.json 是页面的配置文件(重要)
index.wxss 是页面的样式文件
index.wxml 是页面的模板文件
```



###### app.js 是项目启动入口脚本文件

###### app.json 是全局的配置文件(重要)

###### app.wxss 全局样式

###### project.config.json 项目的配置文件

###### 微信小程序下 .js .wxml文件是必须的

![](.\1.png)

### 小程序工作原理

###### 小程序的运行环境分成渲染层和逻辑层，其中 WXML 模板和 WXSS 样式工作在渲染层，JS 脚本工作在逻辑层。

###### 小程序的渲染层和逻辑层分别由2个线程管理：渲染层的界面使用了WebView 进行渲染；逻辑层采用JsCore线程运行JS脚本。一个小程序存在多个界面，所以渲染层存在多个WebView线程，这两个线程的通信会经由微信客户端（下文中也会采用Native来代指微信客户端）做中转，逻辑层发送网络请求也经由Native转发.

### 微信小程序的生命周期

##### 应用的生命周期![](.\应用生命周期.png)



##### 页面生命周期![](.\页面生命周期.png)

- ###### onLoad 页面第一次加载的时候调用，只调用一次，此时我们可以拿到一些页面的打开参数。

- ###### onShow 页面显示或者从后台切回前台的时候调用的，该方法可能会调用多次，比如我们页面的跳转和返回，都会调用onShow。

- ###### onHide 页面隐藏或者切到后台会调用，也是会调用多次。

- ###### onReady 页面渲染完成之后调用，一个页面只调用一次。

- ###### onUnload 页面销毁的时候调用，比如我们点击返回键，那么当前页面会销毁执行onUnload。



### 变量,值传递

语法:{{ }}  wx:if,wx:for wx:else,wx:elif ,wx:key,



### 页面配置

- 只能配置全局配置中的windows属性
- 冲突后会覆盖全局配置
- 开启下来刷新
  - enablePullDownRefresh
- 页面注册逻辑
  - app函数
    - 两种参数
      - 回调函数
      - 全局数据
    - 只能调用一次
    - 注册全局唯一的小程序
  - Page函数
    - 在界面的js文件中
    - 注册一个界面
    - 接收一个对象作为函数的参数,与全局app函数类似



## 什么是有状态的服务

什么是状态

- 上下文关系
- 凭证
  - 如果是无状态的信息,所有的请求都要根据本次请求所携带的信息
  - 陌生人交谈(为啥你还记得我,因为记忆凭证)

http 协议中的状态![](.\http协议状态.jpg)

​        3.小程序的状态![](.\小程序.png)

### 小程序的状态管理

###### 小程序和wx服务器无上下文

###### wx服务器和Django后台无上下文![](.\状态.png

- ###### 小程序Storage存储Cookies

  - ###### Storage的相关概念,使用方法

  - ###### storage存取Cookie

- ###### Django的Session中间件

  - ###### 启用Session中间件

    - ###### 默认是开启的,看settings的中间件配置

### 建立用户体系

1. 用户模型与用户视图
   - 用户的唯一标识 -----openid
   - 用户的基本信息
2. 获取用户的 OpenID![](.\小程序获取openid流程图.jpg)



## 完善

#### 小程序的登录功能

#### 完善用户的个人信息

### 如何实现有状态的服务

#### 小程序的状态管理

#### 复杂多变的用户状态管理

### 有状态的效果

#### 有状态的首页实现